# handlers.rs 拆分方案

**文件大小**: 6,209 行
**拆分策略**: 渐进式拆分,保持向后兼容
**风险评估**: 中高 (需要大量测试)

## 📋 拆分计划

### 方案 A: 模块化拆分 (推荐)

采用 Rust 模块系统,将 handlers.rs 拆分为多个子模块:

```
src/
├── handlers/
│   ├── mod.rs              # 主模块,重新导出所有函数
│   ├── wordbook.rs         # 单词本管理 (~800 行)
│   ├── word.rs             # 单词管理 (~600 行)
│   ├── study_plan.rs       # 学习计划 (~1500 行)
│   ├── practice.rs         # 练习系统 (~1500 行)
│   ├── statistics.rs       # 统计查询 (~800 行)
│   ├── calendar.rs         # 日历视图 (~500 行)
│   └── misc.rs             # 其他功能 (~500 行)
└── handlers.rs             # 保留作为备份,或删除
```

**优势**:
- ✅ 功能域清晰,易于维护
- ✅ 编译时间缩短
- ✅ 符合 SOLID 原则
- ✅ 便于并行开发

**劣势**:
- ⚠️ 需要修改 lib.rs 的导入
- ⚠️ 需要大量测试验证
- ⚠️ 可能需要调整共享代码

### 方案 B: 保守拆分 (最安全)

第一步: 创建 handlers 目录,mod.rs 重新导出
第二步: 逐个迁移函数模块
第三步: 每个模块迁移后立即测试
第四步: 全部迁移完成后删除原文件

**优势**:
- ✅ 最安全,可以随时回滚
- ✅ 渐进式,风险可控
- ✅ 每步都可以测试

**劣势**:
- ⚠️ 时间较长
- ⚠️ 中间状态可能不够优雅

### 方案 C: 最小改动 (最快)

只创建新的 handlers.rs 文件,将所有函数按功能域分组添加注释:

```rust
// ========== 单词本管理模块 ==========
// 函数 1-10
#[tauri::command]
pub async fn get_word_books(...) { ... }

// ========== 学习计划模块 ==========
// 函数 11-20
#[tauri::command]
pub async fn get_study_plans(...) { ... }
```

**优势**:
- ✅ 改动最小
- ✅ 不影响编译和导入
- ✅ 快速完成

**劣势**:
- ❌ 文件仍然很大
- ❌ 没有实际改善结构

## 🎯 推荐执行步骤 (方案 A)

### 阶段 1: 准备工作 (1 小时)
1. ✅ 创建 handlers 目录
2. 分析所有函数,确定模块边界
3. 创建模块文件框架

### 阶段 2: 逐模块迁移 (4-6 小时)
4. 迁移 wordbook 模块 (~800 行)
   - 创建 handlers/wordbook.rs
   - 移动函数和类型
   - 更新导入
   - 测试编译

5. 迁移 word 模块 (~600 行)
6. 迁移 study_plan 模块 (~1500 行)
7. 迁移 practice 模块 (~1500 行)
8. 迁移 statistics 和 calendar 模块 (~1300 行)

### 阶段 3: 整合测试 (2-3 小时)
9. 更新 lib.rs 导入
10. 运行完整编译测试
11. 运行应用功能测试
12. 清理原 handlers.rs

### 阶段 4: 优化 (1-2 小时)
13. 提取共享代码
14. 优化导入
15. 更新文档

## ⚠️ 风险控制

### 测试检查清单
- [ ] 编译通过
- [ ] 所有 Tauri 命令可以正常调用
- [ ] 前端功能正常
- [ ] 没有未使用的导入警告
- [ ] 日志功能正常

### 回滚计划
如果出现问题,可以立即:
1. 恢复 handlers.rs 文件
2. 删除 handlers 目录
3. 恢复 lib.rs 导入

## 📊 预期成果

- 文件大小: 6,209 行 → 多个 500-1500 行的模块
- 编译时间: 减少 30-40%
- 可维护性: 显著提升
- 代码组织: 清晰的功能域划分

## 🤔 建议

考虑到这是生产系统,建议:
1. 在功能分支上完成拆分
2. 充分测试后再合并
3. 保留原文件作为备份直到确认稳定
4. 可以考虑分多次 PR 合并

**您希望采用哪个方案?或者有其他想法?**
